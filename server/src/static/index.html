<!doctype html>
<html>

<head>
    <title>Socket.IO chat</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        input {
            width: 100px;
        }

        table,
        td {
            border: 1px solid #333;
        }

        thead,
        tfoot {
            background-color: #333;
            color: #fff;
        }

        body {
            font: 13px Helvetica, Arial;
        }

        .red {
            color: red;
        }

        .blue {
            color: blue;
        }

        .parent {
            display: flex;
        }

        .child {
            padding: 10px;
        }
    </style>
</head>

<body>
    <div class="parent">
        <div id="play-area" class="child">


            <div>
                Player ID: <input id='player-id' disabled></input><br />
                Player Name: <input id="player-name"></input><br />
                Team: <input id='team-name' disabled></input><br />
            </div><br />
            <div id='game-state'></div>

            <table>
                <thead>
                    <tr>
                        <th colspan="4">Your team's cypher</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>2</td>
                        <td>3</td>
                        <td>4</td>
                    </tr>
                    <tr>
                        <td id="cypher-1"></td>
                        <td id="cypher-2"></td>
                        <td id="cypher-3"></td>
                        <td id="cypher-4"></td>
                    </tr>
                </tbody>
            </table>
            <br />
            <table>
                <thead>
                    <tr>
                        <td colspan="3">Code:</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id='code-1'>?</td>
                        <td id='code-2'>?</td>
                        <td id='code-3'>?</td>
                    </tr>
                    <tr>
                        <td><input id='clue-1' disabled></input></td>
                        <td><input id='clue-2' disabled></input></td>
                        <td><input id='clue-3' disabled></input></td>
                    </tr>
                    <tr>
                        <td colspan="3">
                            <button id='send' disabled>Transmit</button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <br />
            <table>
                <thead>
                    <tr>
                        <td colspan="3">Decrypted Code</td>
                    </tr>
                </thead>

                <tbody>
                    <tr>
                        <td id='guess-1'>?</td>
                        <td id='guess-2'>?</td>
                        <td id='guess-3'>?</td>
                    </tr>
                    <tr>
                        <td colspan="3">
                            <button id='guess' disabled>Submit Team Guess</button>
                        </td>
                    </tr>
                </tbody>
            </table>

        </div>

        <div id="game-state" class="child">
            <h2>Game State</h2>
            <button id="new-game">New Game</button>
            <table>
                <thead>
                    <tr>
                        <td colspan="2">Interceptions</td>
                    </tr>
                </thead>

                <tbody>
                    <tr>
                        <td class="red">Red</td>
                        <td class="blue">Blue</td>
                    </tr>
                    <tr>
                        <td id="red-interceptions">0</td>
                        <td id="blue-interceptions">0</td>
                    </tr>
                </tbody>
                <thead>
                    <tr>
                        <td colspan="2">Transmission Failures</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="red">Red</td>
                        <td class="blue">Blue</td>
                    </tr>
                    <tr>
                        <td id="red-failures">0</td>
                        <td id="blue-failures">0</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="players">
        <ul id="players"></ul>
    </div>


    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script>
        var socket = io();
        $('#player-name').on('input', () => {
            console.log("Input");
            socket.emit('player name', $('#player-name').val());
        });
        $('#send').click(() => {
            const part1 = $('#clue-1').val();
            const part2 = $('#clue-2').val();
            const part3 = $('#clue-3').val();

            const code = [part1, part2, part3];

            console.log("Transmitting code: ", code);
            socket.emit('transmit code', code);
        });
        $('#guess').click(() => {
            const part1 = $('#guess-1').val();
            const part2 = $('#guess-2').val();
            const part3 = $('#guess-3').val();

            const code = [part1, part2, part3];

            console.log("Submitting guess: ", code);
            socket.emit('decrypted code', code);
        });
        $('#new-game').click(() => {
            socket.emit('new game');
        });
        socket.on('welcome', (me) => {
            console.log("Welcome", me);
            $('#player-id').val(me.id);
            $('#player-name').val(me.name);
            $('#team-name').val(me.team);
        });
        socket.on('new player', (player) => {
            console.log("New Player", player);
            const playerli = $('<li>');
            playerli.attr("id", `player-id-${player.id}`);
            playerli.text(player.name);
            playerli.addClass(player.team);
            $("#players").append(playerli);
        });
        socket.on('update player', (player) => {
            console.log("Update player: ", player);
            $(`#player-id-${player.id}`).text(player.name);
        });
        socket.on('player left', (player) => {
            console.log("Player left: ", player);
            $(`#player-id-${player.id}`).remove();
        });
        socket.on('cypher', cypher => {
            console.log("Got team cypher", cypher);
            $('#cypher-1').text(cypher[0]);
            $('#cypher-2').text(cypher[1]);
            $('#cypher-3').text(cypher[2]);
            $('#cypher-4').text(cypher[3]);
        });
        socket.on('code', code => {
            console.log("Got code to transmit", code);
            $('#code-1').text(code[0]);
            $('#code-2').text(code[1]);
            $('#code-3').text(code[2]);

            $('#clue-1').prop('disabled', false);
            $('#clue-2').prop('disabled', false);
            $('#clue-3').prop('disabled', false);

            $('#send').prop('disabled', false);
        });
        socket.on('encrypted transmission', code => {
            $('#code-1').text('?');
            $('#code-2').text('?');
            $('#code-3').text('?');

            $('#clue-1').val(code[0]);
            $('#clue-2').val(code[1]);
            $('#clue-3').val(code[2]);

            $('#clue-1').prop('disabled', true);
            $('#clue-2').prop('disabled', true);
            $('#clue-3').prop('disabled', true);

            $('#send').prop('disabled', true);

            $('#guess').prop('disabled', false);
            $('#submit-guess').prop('disabled', false);
        }); W

        socket.on('game state', game_state => {
            $('#red-interceptions').text(game_state.red.interceptions)
            $('#blue-interceptions').text(game_state.blue.interceptions)

            $('#red-failures').text(game_state.red.transmission_fails)
            $('#blue-failures').text(game_state.blue.transmission_fails)
        })


        // $('form').submit(function (e) {
        //     e.preventDefault(); // prevents page reloading
        //     socket.emit('chat message', $('#m').val());
        //     $('#m').val('');
        //     return false;
        // });
        // socket.on('chat message', function (msg) {
        //     $('#messages').append($('<li>').text(msg));
        // });
    </script>
</body>

</html>
